{"version":3,"sources":["webpack:///./src/pages/search.tsx","webpack:///./src/components/atoms/SearchResultCard/index.tsx","webpack:///./src/components/molecules/SearchResultCategory/index.tsx","webpack:///./src/components/templates/Search/index.tsx"],"names":["timeout","backgroundHover","hover","backgroundColor","scale","SearchResultCard","to","imgSrc","imgSrcSet","title","caption","secondCaption","className","React","isHovered","setHover","LocalizedLink","div","whileHover","variants","onHoverStart","onHoverEnd","classNames","styles","container","imagePlaceholder","LazyImage","notLazy","src","srcSet","alt","image","text","h3","animate","color","p","SearchResultCategory","results","showMore","toggleShowMore","length","header","Message","onClick","moreToggle","resultCardList","slice","map","result","key","heading","resultCard","Search","injectIntl","query","search","isSearching","intl","hasNoResult","members","singles","albums","songs","isInputFocused","setInputFocus","Layout","SearchIcon","searchIcon","borderBottomColor","inputContainer","type","value","onChange","onFocus","onBlur","placeholder","formatMessage","id","input","noResult","category","SearchContainer","useScrollRestoration","setQuery","setResults","setIsSearching","lunr","window","__LUNR__","ja","event","inputQuery","currentTarget","clearTimeout","setTimeout","searchResult","index","extend","ref","store","convertedResults","SearchResultType","Members","push","nameKey","profileImage","small","large","nameNotations","lastName","firstName","lastNameEn","firstNameEn","Singles","number","artwork","medium","toCdNumber","Albums","Songs","songType","single","album","forceCheck"],"mappings":"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","file":"component---src-pages-search-tsx-b97a9071cef42ddc4f26.js","sourcesContent":["import * as React from \"react\";\nimport { forceCheck } from \"react-lazyload\";\nimport { injectIntl } from \"react-intl\";\nimport { Search, SearchResult } from \"components/templates/Search\";\nimport { SearchResultType } from \"utils/constants\";\nimport { SongType } from \"types/responseTypes\";\nimport { useScrollRestoration } from \"utils/hooks\";\nimport { toCdNumber } from \"utils/strings\";\n\nexport type MemberDoc = {\n  id: string;\n  name: string;\n  nameKey: string;\n  nameNotations: {\n    lastName: string;\n    firstName: string;\n    lastNameEn: string;\n    firstNameEn: string;\n    lastNameFurigana: string;\n    firstNameFurigana: string;\n  };\n  profileImage: {\n    large: string;\n    small: string;\n  };\n  type: SearchResultType.Members;\n};\n\nexport type SingleDoc = {\n  id: string;\n  name: string;\n  title: string;\n  number: string;\n  artwork: {\n    large: string;\n    medium: string;\n    small: string;\n  };\n  type: SearchResultType.Singles;\n};\n\nexport type AlbumDoc = {\n  id: string;\n  name: string;\n  title: string;\n  number: string;\n  artwork: {\n    large: string;\n    medium: string;\n    small: string;\n  };\n  type: SearchResultType.Albums;\n};\n\nexport type SongDoc = {\n  id: string;\n  name: string;\n  title: string;\n  key: string;\n  artwork: {\n    large: string;\n    medium: string;\n    small: string;\n  };\n  songType: SongType;\n  single: {\n    number: string;\n    title: string;\n  };\n  album: {\n    number: string;\n    title: string;\n  };\n  type: SearchResultType.Songs;\n};\n\nexport type SearchDoc = AlbumDoc | SingleDoc | SongDoc | MemberDoc;\n\nlet timeout: NodeJS.Timeout;\n\nexport const SearchContainer = injectIntl(({ intl }: { intl: any }) => {\n  useScrollRestoration();\n\n  const [query, setQuery] = React.useState(\"\");\n  const [results, setResults] = React.useState<SearchDoc[]>([]);\n  const [isSearching, setIsSearching] = React.useState(false);\n\n  const lunr = React.useMemo(\n    () => (typeof window !== \"undefined\" ? (window as any).__LUNR__.ja : null),\n    []\n  );\n\n  const search = React.useCallback(\n    (event: React.FormEvent<HTMLInputElement>) => {\n      const inputQuery = event.currentTarget.value;\n      setQuery(inputQuery);\n\n      setIsSearching(true);\n\n      clearTimeout(timeout);\n\n      timeout = setTimeout(() => {\n        const searchResult =\n          inputQuery !== \"\"\n            ? lunr.index\n                .search(`name:*${inputQuery}*`, { extend: true })\n                .map(({ ref }: any) => lunr.store[ref])\n            : [];\n\n        setResults(searchResult);\n\n        setIsSearching(false);\n      }, 300);\n    },\n    [lunr]\n  );\n\n  const convertedResults = React.useMemo(() => {\n    let members: SearchResult[] = [];\n    let singles: SearchResult[] = [];\n    let albums: SearchResult[] = [];\n    let songs: SearchResult[] = [];\n\n    for (const result of results) {\n      switch (result.type) {\n        case SearchResultType.Members:\n          members.push({\n            to: `/${result.type}/${result.nameKey}`,\n            imgSrc: result.profileImage.small,\n            imgSrcSet: `${result.profileImage.large} 2x`,\n            heading: `${result.nameNotations.lastName} ${result.nameNotations.firstName}`,\n            caption: `${result.nameNotations.lastNameEn} ${result.nameNotations.firstNameEn}`,\n          });\n          break;\n        case SearchResultType.Singles:\n          singles.push({\n            to: `/${result.type}/${result.number}`,\n            imgSrc: result.artwork.small,\n            imgSrcSet: `${result.artwork.medium} 2x, ${result.artwork.large} 3x`,\n            heading: result.title,\n            caption: `${toCdNumber(result.number)} single`,\n          });\n          break;\n        case SearchResultType.Albums:\n          albums.push({\n            to: `/${result.type}/${result.number}`,\n            imgSrc: result.artwork.small,\n            imgSrcSet: `${result.artwork.medium} 2x, ${result.artwork.large} 3x`,\n            heading: result.title,\n            caption: `${toCdNumber(result.number)} album`,\n          });\n          break;\n        case SearchResultType.Songs:\n          songs.push({\n            to: `/${result.type}/${result.key}`,\n            imgSrc: result.artwork.small,\n            imgSrcSet: `${result.artwork.medium} 2x, ${result.artwork.large} 3x`,\n            heading: result.title,\n            caption: `#${intl.formatMessage({\n              id: result.songType,\n            })}`,\n            secondCaption:\n              result.single.number !== \"\"\n                ? `#${toCdNumber(result.single.number)} single`\n                : `#${toCdNumber(result.album.number)} album`,\n          });\n          break;\n        default:\n          break;\n      }\n    }\n\n    return { members, singles, albums, songs };\n  }, [results, intl]);\n\n  React.useEffect(() => {\n    forceCheck();\n  }, [results]);\n\n  return (\n    <Search\n      query={query}\n      search={search}\n      results={convertedResults}\n      isSearching={isSearching}\n    />\n  );\n});\n\nexport default () => <SearchContainer />;\n","import * as React from \"react\";\nimport { motion } from \"framer-motion\";\nimport styles from \"./searchresultcard.module.scss\";\nimport { LazyImage } from \"components/atoms/LazyImage\";\nimport { classNames } from \"utils/strings\";\nimport { LocalizedLink } from \"components/atoms/locales/LocalizedLink\";\n\nconst backgroundHover = {\n  hover: {\n    backgroundColor: \"#757575\",\n    scale: 1.05,\n  },\n};\n\ninterface SearchResultCardProps {\n  to: string;\n  imgSrc: string;\n  imgSrcSet: string;\n  title: string;\n  caption: string;\n  secondCaption?: string;\n  className?: string;\n}\n\nexport const SearchResultCard = ({\n  to,\n  imgSrc,\n  imgSrcSet,\n  title,\n  caption,\n  secondCaption,\n  className,\n}: SearchResultCardProps) => {\n  const [isHovered, setHover] = React.useState(false);\n\n  return (\n    <LocalizedLink to={to}>\n      <motion.div\n        whileHover=\"hover\"\n        variants={backgroundHover}\n        onHoverStart={() => setHover(true)}\n        onHoverEnd={() => setHover(false)}\n        className={classNames(styles.container, className)}\n      >\n        <div className={styles.imagePlaceholder}>\n          <LazyImage\n            notLazy\n            src={imgSrc}\n            srcSet={imgSrcSet}\n            alt={title}\n            className={styles.image}\n          />\n        </div>\n        <div className={styles.text}>\n          <motion.h3\n            animate={{ color: isHovered ? \"#ffffff\" : \"#595959\" }}\n            className={styles.title}\n          >\n            {title}\n          </motion.h3>\n          <motion.p\n            animate={{ color: isHovered ? \"#ffffff\" : \"#757575\" }}\n            className={styles.caption}\n          >\n            <span>{caption}</span>\n            {secondCaption ? <span>{secondCaption}</span> : null}\n          </motion.p>\n        </div>\n      </motion.div>\n    </LocalizedLink>\n  );\n};\n","import * as React from \"react\";\nimport styles from \"./searchresultcategory.module.scss\";\nimport { SearchResultCard } from \"components/atoms/SearchResultCard\";\nimport { Message } from \"components/atoms/Message\";\n\ninterface SearchResultCategoryProps {\n  title: string;\n  results: {\n    to: string;\n    imgSrc: string;\n    imgSrcSet: string;\n    heading: string;\n    caption: string;\n    secondCaption?: string;\n  }[];\n  className?: string;\n}\n\nexport const SearchResultCategory = ({\n  title,\n  results,\n  className,\n}: SearchResultCategoryProps) => {\n  const [showMore, toggleShowMore] = React.useState(false);\n\n  return results.length > 0 ? (\n    <div className={className}>\n      <div className={styles.header}>\n        <h2 className={styles.title}>\n          <Message text={title} />\n        </h2>\n        {results.length > 3 ? (\n          !showMore ? (\n            <button\n              onClick={() => toggleShowMore(true)}\n              className={styles.moreToggle}\n            >\n              <Message text=\"show all\" />\n            </button>\n          ) : (\n            <button\n              onClick={() => toggleShowMore(false)}\n              className={styles.moreToggle}\n            >\n              <Message text=\"show less\" />\n            </button>\n          )\n        ) : null}\n      </div>\n      <ul className={styles.resultCardList}>\n        {results.slice(0, 3).map(result => (\n          <li key={result.heading} className={styles.resultCard}>\n            <SearchResultCard\n              to={result.to}\n              imgSrc={result.imgSrc}\n              imgSrcSet={result.imgSrcSet}\n              title={result.heading}\n              caption={result.caption}\n              secondCaption={result.secondCaption}\n            />\n          </li>\n        ))}\n        {showMore\n          ? results.slice(3, results.length).map(result => (\n              <li key={result.heading} className={styles.resultCard}>\n                <SearchResultCard\n                  to={result.to}\n                  imgSrc={result.imgSrc}\n                  imgSrcSet={result.imgSrcSet}\n                  title={result.heading}\n                  caption={result.caption}\n                  secondCaption={result.secondCaption}\n                />\n              </li>\n            ))\n          : null}\n      </ul>\n    </div>\n  ) : null;\n};\n","import * as React from \"react\";\nimport { injectIntl } from \"react-intl\";\nimport { motion } from \"framer-motion\";\nimport styles from \"./search.module.scss\";\nimport { Layout } from \"components/atoms/Layout\";\nimport { SearchIcon } from \"components/atoms/icons/SearchIcon\";\nimport { Message } from \"components/atoms/Message\";\nimport { SearchResultCategory } from \"components/molecules/SearchResultCategory\";\n\nexport type SearchResult = {\n  to: string;\n  imgSrc: string;\n  imgSrcSet: string;\n  heading: string;\n  caption: string;\n  secondCaption?: string;\n};\n\ninterface SearchProps {\n  query: string;\n  search(event: React.FormEvent<HTMLInputElement>): void;\n  results: {\n    members: SearchResult[];\n    singles: SearchResult[];\n    albums: SearchResult[];\n    songs: SearchResult[];\n  };\n  isSearching: boolean;\n  intl: any;\n}\n\nexport const Search = injectIntl(\n  ({ query, search, results, isSearching, intl }: SearchProps) => {\n    const hasNoResult = React.useMemo(\n      () =>\n        results.members.length +\n          results.singles.length +\n          results.albums.length +\n          results.songs.length ===\n          0 &&\n        query !== \"\" &&\n        !isSearching,\n      [results, query, isSearching]\n    );\n\n    const [isInputFocused, setInputFocus] = React.useState(false);\n\n    return (\n      <Layout className={styles.container}>\n        <div className={styles.search}>\n          <SearchIcon className={styles.searchIcon} />\n          <motion.div\n            animate={{\n              borderBottomColor: isInputFocused ? \"#595959\" : \"#d6d6d6\",\n            }}\n            className={styles.inputContainer}\n          >\n            <input\n              type=\"text\"\n              value={query}\n              onChange={search}\n              onFocus={() => setInputFocus(true)}\n              onBlur={() => setInputFocus(false)}\n              placeholder={intl.formatMessage({\n                id: \"Song title, member name, etc.\",\n              })}\n              className={styles.input}\n            />\n          </motion.div>\n        </div>\n        {hasNoResult ? (\n          <p className={styles.noResult}>\n            <Message text=\"no result\" />\n          </p>\n        ) : null}\n        <SearchResultCategory\n          title=\"members\"\n          results={results.members}\n          className={styles.category}\n        />\n        <SearchResultCategory\n          title=\"singles\"\n          results={results.singles}\n          className={styles.category}\n        />\n        <SearchResultCategory\n          title=\"albums\"\n          results={results.albums}\n          className={styles.category}\n        />\n        <SearchResultCategory title=\"songs\" results={results.songs} />\n      </Layout>\n    );\n  }\n);\n"],"sourceRoot":""}