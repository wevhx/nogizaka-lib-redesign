{"version":3,"sources":["webpack:///./src/pages/search.tsx","webpack:///./src/components/atoms/SearchResultCard/index.tsx","webpack:///./src/components/templates/Search/index.tsx"],"names":["timeout","SearchResultCard","to","imgSrc","imgSrcSet","title","caption","secondCaption","className","LocalizedLink","classNames","styles","container","imagePlaceholder","LazyImage","notLazy","src","srcSet","alt","image","text","Search","injectIntl","query","search","results","isSearching","intl","hasNoResult","React","members","length","singles","albums","songs","Layout","SearchIcon","searchIcon","inputContainer","type","value","onChange","placeholder","formatMessage","id","input","noResult","Message","category","categoryTitle","resultCardList","map","result","key","name","resultCard","nameKey","profileImage","small","large","nameNotations","lastName","firstName","lastNameEn","firstNameEn","number","artwork","medium","toCdNumber","songType","single","album","SearchContainer","useScrollRestoration","setQuery","setResults","setIsSearching","lunr","window","__LUNR__","ja","event","inputQuery","currentTarget","clearTimeout","setTimeout","searchResult","index","extend","ref","store","convertedResults","SearchResultType","Members","push","Singles","Albums","Songs","console","log","forceCheck"],"mappings":"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","file":"component---src-pages-search-tsx-177260618d2d4a54ebf2.js","sourcesContent":["import * as React from \"react\";\nimport { forceCheck } from \"react-lazyload\";\nimport {\n  Search,\n  MemberResult,\n  SingleResult,\n  AlbumResult,\n  SongResult,\n} from \"components/templates/Search\";\nimport { SearchResultType } from \"utils/constants\";\nimport { SongType } from \"types/responseTypes\";\nimport { useScrollRestoration } from \"utils/hooks\";\n\nexport type MemberDoc = {\n  id: string;\n  name: string;\n  nameKey: string;\n  nameNotations: {\n    lastName: string;\n    firstName: string;\n    lastNameEn: string;\n    firstNameEn: string;\n    lastNameFurigana: string;\n    firstNameFurigana: string;\n  };\n  profileImage: {\n    large: string;\n    small: string;\n  };\n  type: SearchResultType.Members;\n};\n\nexport type SingleDoc = {\n  id: string;\n  name: string;\n  title: string;\n  number: string;\n  artwork: {\n    large: string;\n    medium: string;\n    small: string;\n  };\n  type: SearchResultType.Singles;\n};\n\nexport type AlbumDoc = {\n  id: string;\n  name: string;\n  title: string;\n  number: string;\n  artwork: {\n    large: string;\n    medium: string;\n    small: string;\n  };\n  type: SearchResultType.Albums;\n};\n\nexport type SongDoc = {\n  id: string;\n  name: string;\n  title: string;\n  key: string;\n  artwork: {\n    large: string;\n    medium: string;\n    small: string;\n  };\n  songType: SongType;\n  single: {\n    number: string;\n    title: string;\n  };\n  album: {\n    number: string;\n    title: string;\n  };\n  type: SearchResultType.Songs;\n};\n\nexport type SearchDoc = AlbumDoc | SingleDoc | SongDoc | MemberDoc;\n\nlet timeout: NodeJS.Timeout;\n\nexport const SearchContainer = () => {\n  useScrollRestoration();\n\n  const [query, setQuery] = React.useState(\"\");\n  const [results, setResults] = React.useState<SearchDoc[]>([]);\n  const [isSearching, setIsSearching] = React.useState(false);\n\n  const lunr = React.useMemo(\n    () => (typeof window !== \"undefined\" ? (window as any).__LUNR__.ja : null),\n    []\n  );\n\n  const search = React.useCallback(\n    (event: React.FormEvent<HTMLInputElement>) => {\n      const inputQuery = event.currentTarget.value;\n      setQuery(inputQuery);\n\n      setIsSearching(true);\n\n      clearTimeout(timeout);\n\n      timeout = setTimeout(() => {\n        const searchResult =\n          inputQuery !== \"\"\n            ? lunr.index\n                .search(`name:*${inputQuery}*`, { extend: true })\n                .map(({ ref }: any) => lunr.store[ref])\n            : [];\n\n        setResults(searchResult);\n\n        setIsSearching(false);\n      }, 1000);\n    },\n    [lunr]\n  );\n\n  const convertedResults = React.useMemo(() => {\n    let members: MemberResult[] = [];\n    let singles: SingleResult[] = [];\n    let albums: AlbumResult[] = [];\n    let songs: SongResult[] = [];\n\n    for (const result of results) {\n      switch (result.type) {\n        case SearchResultType.Members:\n          members.push({\n            name: result.name,\n            nameKey: result.nameKey,\n            nameNotations: result.nameNotations,\n            profileImage: result.profileImage,\n            type: result.type,\n          });\n          break;\n        case SearchResultType.Singles:\n          singles.push({\n            title: result.title,\n            number: result.number,\n            artwork: result.artwork,\n            type: result.type,\n          });\n          break;\n        case SearchResultType.Albums:\n          albums.push({\n            title: result.title,\n            number: result.number,\n            artwork: result.artwork,\n            type: result.type,\n          });\n          break;\n        case SearchResultType.Songs:\n          songs.push({\n            title: result.title,\n            key: result.key,\n            artwork: result.artwork,\n            songType: result.songType,\n            single: result.single,\n            album: result.album,\n            type: result.type,\n          });\n          break;\n        default:\n          break;\n      }\n    }\n\n    return { members, singles, albums, songs };\n  }, [results]);\n\n  console.log({ query, results });\n\n  React.useEffect(() => {\n    forceCheck();\n  }, [results]);\n\n  return (\n    <Search\n      query={query}\n      search={search}\n      results={convertedResults}\n      isSearching={isSearching}\n    />\n  );\n};\n\nexport default () => <SearchContainer />;\n","import * as React from \"react\";\nimport styles from \"./searchresultcard.module.scss\";\nimport { LazyImage } from \"components/atoms/LazyImage\";\nimport { classNames } from \"utils/strings\";\nimport { LocalizedLink } from \"components/atoms/locales/LocalizedLink\";\n\ninterface SearchResultCardProps {\n  to: string;\n  imgSrc: string;\n  imgSrcSet: string;\n  title: string;\n  caption: string;\n  secondCaption?: string;\n  className?: string;\n}\n\nexport const SearchResultCard = ({\n  to,\n  imgSrc,\n  imgSrcSet,\n  title,\n  caption,\n  secondCaption,\n  className,\n}: SearchResultCardProps) => {\n  return (\n    <LocalizedLink to={to}>\n      <div className={classNames(styles.container, className)}>\n        <div className={styles.imagePlaceholder}>\n          <LazyImage\n            notLazy\n            src={imgSrc}\n            srcSet={imgSrcSet}\n            alt={title}\n            className={styles.image}\n          />\n        </div>\n        <div className={styles.text}>\n          <h3 className={styles.title}>{title}</h3>\n          <p className={styles.caption}>\n            <span>{caption}</span>\n            {secondCaption ? <span>{secondCaption}</span> : null}\n          </p>\n        </div>\n      </div>\n    </LocalizedLink>\n  );\n};\n","import * as React from \"react\";\nimport { injectIntl } from \"react-intl\";\nimport styles from \"./search.module.scss\";\nimport { Layout } from \"components/atoms/Layout\";\nimport { SearchResultCard } from \"components/atoms/SearchResultCard\";\nimport { toCdNumber } from \"utils/strings\";\nimport { SearchIcon } from \"components/atoms/icons/SearchIcon\";\nimport { SongType } from \"types/responseTypes\";\nimport { Message } from \"components/atoms/Message\";\nimport { SearchResultType } from \"utils/constants\";\n\nexport type MemberResult = {\n  name: string;\n  nameKey: string;\n  nameNotations: {\n    lastName: string;\n    firstName: string;\n    lastNameEn: string;\n    firstNameEn: string;\n    lastNameFurigana: string;\n    firstNameFurigana: string;\n  };\n  profileImage: {\n    large: string;\n    small: string;\n  };\n  type: SearchResultType.Members;\n};\n\nexport type SingleResult = {\n  title: string;\n  number: string;\n  artwork: {\n    large: string;\n    medium: string;\n    small: string;\n  };\n  type: SearchResultType.Singles;\n};\n\nexport type AlbumResult = {\n  title: string;\n  number: string;\n  artwork: {\n    large: string;\n    medium: string;\n    small: string;\n  };\n  type: SearchResultType.Albums;\n};\n\nexport type SongResult = {\n  title: string;\n  key: string;\n  artwork: {\n    large: string;\n    medium: string;\n    small: string;\n  };\n  songType: SongType;\n  single: {\n    number: string;\n    title: string;\n  };\n  album: {\n    number: string;\n    title: string;\n  };\n  type: SearchResultType.Songs;\n};\n\ninterface SearchProps {\n  query: string;\n  search(event: React.FormEvent<HTMLInputElement>): void;\n  results: {\n    members: MemberResult[];\n    singles: SingleResult[];\n    albums: AlbumResult[];\n    songs: SongResult[];\n  };\n  isSearching: boolean;\n  intl: any;\n}\n\nexport const Search = injectIntl(\n  ({ query, search, results, isSearching, intl }: SearchProps) => {\n    const hasNoResult = React.useMemo(\n      () =>\n        results.members.length +\n          results.singles.length +\n          results.albums.length +\n          results.songs.length ===\n          0 &&\n        query !== \"\" &&\n        !isSearching,\n      [results, query, isSearching]\n    );\n\n    return (\n      <Layout>\n        <div className={styles.search}>\n          <SearchIcon className={styles.searchIcon} />\n          <div className={styles.inputContainer}>\n            <input\n              type=\"text\"\n              value={query}\n              onChange={search}\n              placeholder={intl.formatMessage({\n                id: \"Song title, member name, etc.\",\n              })}\n              className={styles.input}\n            />\n          </div>\n        </div>\n        {hasNoResult ? (\n          <p className={styles.noResult}>\n            <Message text=\"no result\" />\n          </p>\n        ) : null}\n        {results.members.length > 0 ? (\n          <div className={styles.category}>\n            <h2 className={styles.categoryTitle}>members</h2>\n            <ul className={styles.resultCardList}>\n              {results.members.map(result => (\n                <li key={result.name} className={styles.resultCard}>\n                  <SearchResultCard\n                    to={`/${result.type}/${result.nameKey}`}\n                    imgSrc={result.profileImage.small}\n                    imgSrcSet={`${result.profileImage.large} 2x`}\n                    title={\n                      result.nameNotations.lastName +\n                      \" \" +\n                      result.nameNotations.firstName\n                    }\n                    caption={\n                      result.nameNotations.lastNameEn +\n                      \" \" +\n                      result.nameNotations.firstNameEn\n                    }\n                  />\n                </li>\n              ))}\n            </ul>\n          </div>\n        ) : null}\n        {results.singles.length > 0 ? (\n          <div className={styles.category}>\n            <h2 className={styles.categoryTitle}>Singles</h2>\n            <ul className={styles.resultCardList}>\n              {results.singles.map(result => (\n                <li key={result.title} className={styles.resultCard}>\n                  <SearchResultCard\n                    to={`/${result.type}/${result.number}`}\n                    imgSrc={result.artwork.small}\n                    imgSrcSet={`${result.artwork.medium} 2x, ${result.artwork.large} 3x`}\n                    title={result.title}\n                    caption={toCdNumber(result.number) + \" single\"}\n                  />\n                </li>\n              ))}\n            </ul>\n          </div>\n        ) : null}\n        {results.albums.length > 0 ? (\n          <div className={styles.category}>\n            <h2 className={styles.categoryTitle}>Albums</h2>\n            <ul className={styles.resultCardList}>\n              {results.albums.map(result => (\n                <li key={result.title} className={styles.resultCard}>\n                  <SearchResultCard\n                    to={`/${result.type}/${result.number}`}\n                    imgSrc={result.artwork.small}\n                    imgSrcSet={`${result.artwork.medium} 2x, ${result.artwork.large} 3x`}\n                    title={result.title}\n                    caption={toCdNumber(result.number) + \" album\"}\n                  />\n                </li>\n              ))}\n            </ul>\n          </div>\n        ) : null}\n        {results.songs.length > 0 ? (\n          <div className={styles.category}>\n            <h2 className={styles.categoryTitle}>Songs</h2>\n            <ul className={styles.resultCardList}>\n              {results.songs.map(result => (\n                <li key={result.title} className={styles.resultCard}>\n                  <SearchResultCard\n                    to={`/${result.type}/${result.key}`}\n                    imgSrc={result.artwork.small}\n                    imgSrcSet={`${result.artwork.medium} 2x, ${result.artwork.large} 3x`}\n                    title={result.title}\n                    caption={`#${intl.formatMessage({\n                      id: result.songType,\n                    })}`}\n                    secondCaption={\n                      result.single.number !== \"\"\n                        ? `#${toCdNumber(result.single.number)} single`\n                        : `#${toCdNumber(result.album.number)} album`\n                    }\n                  />\n                </li>\n              ))}\n            </ul>\n          </div>\n        ) : null}\n      </Layout>\n    );\n  }\n);\n"],"sourceRoot":""}